<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ·«è¡“æ‹³ ã€œå°å°ã‚’è§£ã‹ã‚Œã—å·«å¥³ã€œ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        @import url('https://fonts.googleapis.com/css2?family=Cinzel:wght@400;600&family=Cinzel+Decorative:wght@400;700&display=swap');
        
        body {
            background: radial-gradient(ellipse at center, #2d1b45 0%, #1a0a2e 50%, #0f0033 100%);
            color: white;
            font-family: 'Cinzel', serif;
            height: 100vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            position: relative;
        }

        /* èƒŒæ™¯ç”»åƒç”¨ã®ã‚³ãƒ³ãƒ†ãƒŠ */
        .background-image {
            position: fixed; /* absoluteã‹ã‚‰fixedã«å¤‰æ›´ */
            top: 0;
            left: 0;
            width: 100vw;  /* 100%ã‹ã‚‰100vwã«å¤‰æ›´ */
            height: 100vh; /* 100%ã‹ã‚‰100vhã«å¤‰æ›´ */
            background-image: url('background.jpg'); /* å¾Œã§ç”»åƒãƒ‘ã‚¹ã‚’è¨­å®š */
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            opacity: 0.3; /* é€æ˜åº¦è¨­å®š */
            z-index: 0; /* -1ã‹ã‚‰0ã«å¤‰æ›´ */
            pointer-events: none; /* ã‚¯ãƒªãƒƒã‚¯ä¸å¯ã«ã™ã‚‹ */
        }

        /* ========== ãƒ˜ãƒƒãƒ€ãƒ¼éƒ¨åˆ† ========== */
        .header {
            height: 80px;
            background: linear-gradient(180deg, rgba(0,0,0,0.6) 0%, rgba(0,0,0,0.2) 100%);
            display: grid;
            grid-template-columns: 1fr auto 1fr;
            align-items: center;
            padding: 0 30px;
            position: relative;
            z-index: 1;
        }

        .hp-section {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .hp-section.player {
            justify-content: flex-start;
        }

        .hp-section.enemy {
            justify-content: flex-end;
        }

        .hp-label {
            color: #ddd;
            font-size: 16px;
            font-weight: 600;
            font-family: 'Cinzel', serif;
            white-space: nowrap;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.8);
            letter-spacing: 1px;
        }

        .hp-bar-container {
            width: 180px;
            height: 22px;
            background: rgba(0, 0, 0, 0.7);
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            overflow: hidden;
        }

        .hp-bar {
            height: 100%;
            transition: width 0.5s ease;
        }

        .hp-bar.player {
            background: linear-gradient(90deg, #00ff00 0%, #66ff66 50%, #00ff00 100%);
            box-shadow: 0 0 10px rgba(0, 255, 0, 0.5);
        }

        .hp-bar.enemy {
            background: linear-gradient(90deg, #ff00ff 0%, #ff66ff 50%, #ff00ff 100%);
            box-shadow: 0 0 10px rgba(255, 0, 255, 0.5);
        }

        .hp-text {
            font-weight: bold;
            font-size: 16px;
            white-space: nowrap;
        }

        .hp-text.player {
            color: #66ff66;
            text-shadow: 0 0 5px rgba(0, 255, 0, 0.5);
        }

        .hp-text.enemy {
            color: #ff66ff;
            text-shadow: 0 0 5px rgba(255, 0, 255, 0.5);
        }

        .round-display {
            text-align: center;
        }

        .round-text {
            font-size: 42px;
            font-weight: 600;
            font-family: 'Cinzel Decorative', serif;
            color: #ffd700;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.8), 0 0 20px rgba(255, 215, 0, 0.3);
            letter-spacing: 4px;
        }

        .score-display {
            margin-top: 8px;
            font-size: 18px;
            display: flex;
            justify-content: center;
            gap: 20px;
        }

        .score-win { color: #66ff66; }
        .score-draw { color: #ffd700; }
        .score-lose { color: #ff66ff; }

        /* ========== ãƒ¡ã‚¤ãƒ³ãƒãƒˆãƒ«ã‚¨ãƒªã‚¢ ========== */
        .battle-area {
            flex: 1;
            position: relative;
            display: flex;
            justify-content: center;
            align-items: center;
            padding-bottom: 100px;  /* ä¸‹ã«ãƒ‘ãƒ‡ã‚£ãƒ³ã‚°ã‚’è¿½åŠ ã—ã¦å…¨ä½“ã‚’ä¸Šã«æŠ¼ã—ä¸Šã’ */
            z-index: 1;
        }

        .fighters-container {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 300px;
        }

        .fighter {
            position: relative;
            text-align: center;
        }

        .fighter-name {
            font-size: 28px;
            font-weight: 600;
            font-family: 'Cinzel', serif;
            margin-bottom: 20px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.8), 0 0 15px rgba(255, 255, 255, 0.2);
            letter-spacing: 2px;
        }

        .fighter-name.player { color: #66ff66; }
        .fighter-name.enemy { color: #ff66ff; }

        .fighter-emoji {
            font-size: 140px;
            filter: drop-shadow(0 0 30px rgba(255, 255, 255, 0.2));
            animation: float 3s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        .vs-display {
            font-size: 72px;
            font-weight: 700;
            font-family: 'Cinzel Decorative', serif;
            color: #ffd700;
            text-shadow: 3px 3px 6px rgba(0, 0, 0, 0.9), 0 0 30px rgba(255, 215, 0, 0.4);
            letter-spacing: 6px;
        }

        /* éœ²å‡ºè¡¨ç¤ºï¼ˆå·¦ä¸‹ï¼‰ */
        .exposure-display {
            position: absolute;
            left: 50px;
            bottom: 200px;
        }

        .exposure-dots {
            font-size: 24px;
            color: #ffd700;
            letter-spacing: 5px;
            margin-bottom: 8px;
        }

        .exposure-label {
            color: #ff6666;
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .exposure-desc {
            color: #ccc;
            font-size: 14px;
            line-height: 1.4;
        }

        /* æ•µãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ï¼ˆå³ä¸‹ï¼‰ */
        /* æŒ‘ç™ºåˆ¤æ˜ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ï¼ˆenemy-messageã®ä¸Šï¼‰ */
        .provoke-reveal {
            position: absolute;
            right: 50px;
            bottom: 280px;
            background: rgba(255, 215, 0, 0.9);
            color: #333;
            padding: 8px 15px;
            border-radius: 15px;
            border: 1px solid #ffd700;
            font-size: 12px;
            font-weight: 600;
            box-shadow: 0 2px 8px rgba(255, 215, 0, 0.3);
            max-width: 280px;
            text-align: center;
            backdrop-filter: blur(5px);
            word-wrap: break-word;
            line-height: 1.2;
            display: none;
        }

        .enemy-message {
            position: absolute;
            right: 50px;
            bottom: 200px;
            background: rgba(156, 39, 176, 0.2);
            border: 2px solid rgba(156, 39, 176, 0.6);
            border-radius: 25px;
            padding: 20px 30px;
            font-size: 18px;
            color: white;
            box-shadow: 0 0 20px rgba(156, 39, 176, 0.3);
        }

        /* ========== ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«éƒ¨åˆ†ï¼ˆæœ€é©åŒ–ã‚µã‚¤ã‚ºï¼‰ ========== */
        .control-container {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 200px;  /* é«˜ã•ã‚’æ‹¡å¤§ */
            background: linear-gradient(180deg, rgba(0,0,0,0.3) 0%, rgba(0,0,0,0.8) 100%);
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 10px 0;
            z-index: 2;
        }

        /* ä¸­å¤®ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ */
        .control-content {
            display: flex;
            gap: 15px;
            max-width: 750px;
            width: 100%;
            height: 180px;  /* é«˜ã•ã‚’æ‹¡å¤§ */
            align-items: center;
            justify-content: center;
        }

        /* ãƒãƒ³ãƒ‰ã‚»ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ï¼ˆ300Ã—180ï¼‰ */
        .hand-selection {
            background: rgba(25, 25, 45, 0.9);
            border: 2px solid rgba(120, 120, 160, 0.5);
            border-radius: 12px;
            padding: 10px;
            width: 300px;  /* 300ã«ç‹­ã‚ã‚‹ */
            height: 180px; /* 180ç¶­æŒ */
            display: flex;
            flex-direction: column;
        }

        .selection-status {
            text-align: center;
            color: #ffd700;
            font-size: 14px;
            margin-bottom: 8px;
            height: 20px;
        }

        /* æ‰‹é¸æŠã‚¨ãƒªã‚¢ */
        .hands-and-actions {
            flex: 1;
            display: flex;
            gap: 8px;
        }

        /* æ‰‹é¸æŠãƒœã‚¿ãƒ³ã‚¨ãƒªã‚¢ï¼ˆ133Ã—128ï¼‰ */
        .hand-buttons-area {
            width: 160px;  /* å°‘ã—å¹…ã‚’åºƒã */
            height: 128px; /* å›ºå®šé«˜ã• */
            display: flex;
            flex-direction: column;
            gap: 6px;
        }

        .hand-btn {
            flex: 1;
            background: linear-gradient(135deg, rgba(50, 50, 90, 0.9) 0%, rgba(35, 35, 70, 0.9) 100%);
            border: 2px solid rgba(120, 120, 160, 0.6);
            border-radius: 8px;
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            padding: 0 8px;
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
            min-height: 36px;  /* å°‘ã—å°ã•ã */
            font-size: 14px;   /* ãƒ•ã‚©ãƒ³ãƒˆã‚µã‚¤ã‚ºèª¿æ•´ */
        }

        .hand-btn:hover {
            background: linear-gradient(135deg, rgba(60, 60, 100, 0.9) 0%, rgba(40, 40, 80, 0.9) 100%);
            border-color: rgba(150, 150, 200, 0.7);
            transform: translateX(2px);
        }

        .hand-btn.selected {
            background: linear-gradient(135deg, rgba(33, 150, 243, 0.7) 0%, rgba(21, 101, 192, 0.7) 100%);
            border-color: #2196f3;
            box-shadow: 0 0 12px rgba(33, 150, 243, 0.5), inset 0 0 8px rgba(33, 150, 243, 0.2);
        }

        .hand-icon {
            font-size: 16px;
            margin-right: 8px;
        }

        .hand-name {
            font-size: 14px;
            font-weight: bold;
            flex: 1;
        }

        .key-hint {
            color: #bbb;
            font-size: 12px;
        }

        /* ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³ï¼ˆãƒãƒ³ãƒ‰ã‚»ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³å†…ã«é…ç½®ï¼‰ */
        .action-buttons {
            display: flex;
            flex-direction: column;
            gap: 6px;
            width: 110px;  /* å¹…ã‚’ç‹­ã‚ã‚‹ */
        }

        .action-btn {
            flex: 1;
            border: none;
            border-radius: 8px;
            font-size: 13px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            min-height: 36px;
        }

        .reveal-btn {
            background: linear-gradient(135deg, #4caf50 0%, #45a049 100%);
            color: white;
            box-shadow: 0 2px 8px rgba(76, 175, 80, 0.3);
        }

        .reveal-btn:hover:not(:disabled) {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(76, 175, 80, 0.4);
        }

        .reveal-btn:disabled {
            background: linear-gradient(135deg, #444 0%, #333 100%);
            color: #666;
            cursor: not-allowed;
            box-shadow: none;
        }

        .provoke-btn {
            background: linear-gradient(135deg, #ef5350 0%, #e57373 100%);
            color: white;
            box-shadow: 0 2px 8px rgba(239, 83, 80, 0.3);
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 13px;
        }

        .provoke-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(239, 83, 80, 0.4);
        }

        .restart-btn {
            background: linear-gradient(135deg, #64b5f6 0%, #42a5f5 100%);
            color: white;
            box-shadow: 0 2px 8px rgba(100, 181, 246, 0.3);
            font-size: 12px;
        }

        .restart-btn:hover:not(:disabled) {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(100, 181, 246, 0.4);
        }
        .restart-btn:disabled {
            background: #666;
            cursor: not-allowed;
            opacity: 0.5;
        }

        /* æœè£…å¤‰åŒ–ã‚·ãƒ¼ãƒ³ */
        .clothing-change-scene {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: linear-gradient(135deg, #2d1b45 0%, #1a0a2e 50%, #0f0033 100%);
            z-index: 1000;
            opacity: 0;
            transition: opacity 0.5s ease;
        }

        .clothing-change-scene.active {
            opacity: 1;
        }

        .pov-container {
            position: relative;
            width: 100%;
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .suzune-character {
            position: relative;
            width: 300px;
            height: 400px;
            display: flex;
            justify-content: center;
            align-items: center;
            transition: all 0.3s ease;
        }

        .suzune-character.live-mode {
            animation: breathing 4s ease-in-out infinite;
        }

        .character-base {
            font-size: 200px;
            transition: all 0.5s ease;
        }

        .character-base.live-mode {
            animation: clothSway 3s ease-in-out infinite;
        }

        /* 2D Liveé¢¨ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ */
        @keyframes breathing {
            0%, 100% { 
                transform: translateY(0px) scale(1); 
            }
            50% { 
                transform: translateY(-3px) scale(1.02); 
            }
        }

        @keyframes clothSway {
            0%, 100% { 
                transform: rotate(-0.8deg); 
            }
            50% { 
                transform: rotate(0.8deg); 
            }
        }

        /* è§¦ã‚Œã‚‰ã‚ŒãŸæ™‚ã®ãƒªã‚¢ã‚¯ã‚·ãƒ§ãƒ³ */
        .character-base.touched {
            animation: trembling 0.6s ease-in-out;
            filter: hue-rotate(15deg) brightness(1.1);
        }

        @keyframes trembling {
            0%, 100% { transform: translateX(0px); }
            10% { transform: translateX(-2px) rotate(-1deg); }
            20% { transform: translateX(2px) rotate(1deg); }
            30% { transform: translateX(-1px) rotate(-0.5deg); }
            40% { transform: translateX(1px) rotate(0.5deg); }
            50% { transform: translateX(-1px) rotate(-0.3deg); }
            60% { transform: translateX(1px) rotate(0.3deg); }
            70% { transform: translateX(-0.5px); }
            80% { transform: translateX(0.5px); }
            90% { transform: translateX(-0.2px); }
        }

        /* è¡¨æƒ…å¤‰åŒ–ã‚¨ãƒ•ã‚§ã‚¯ãƒˆ */
        .character-base.shy {
            animation: blinking 2s ease-in-out infinite;
            filter: hue-rotate(30deg) saturate(1.2);
        }

        @keyframes blinking {
            0%, 90%, 100% { opacity: 1; }
            95% { opacity: 0.7; }
        }

        /* æ¥ãšã‹ã—ãŒã‚‹è¡¨æƒ…ã®æ®µéšå¤‰åŒ– */
        .character-base.embarrassed {
            animation: embarrassedReaction 1.5s ease-in-out;
            filter: hue-rotate(45deg) brightness(1.2) saturate(1.3);
        }

        @keyframes embarrassedReaction {
            0% { transform: scale(1) rotate(0deg); }
            20% { transform: scale(0.95) rotate(-2deg); }
            40% { transform: scale(1.05) rotate(1deg); }
            60% { transform: scale(0.98) rotate(-0.5deg); }
            80% { transform: scale(1.02) rotate(0.5deg); }
            100% { transform: scale(1) rotate(0deg); }
        }

        .player-hand {
            position: absolute;
            bottom: 100px;
            right: 200px;
            font-size: 80px;
            cursor: pointer;
            transition: transform 0.3s ease;
        }

        .player-hand:hover {
            transform: scale(1.1);
        }

        .player-hand.grabbing {
            transform: scale(0.9) rotate(15deg);
        }

        .scene-instruction {
            position: absolute;
            bottom: 50px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.7);
            padding: 15px 30px;
            border-radius: 25px;
            border: 2px solid #666;
            color: white;
            font-size: 16px;
            text-align: center;
        }

        /* é€€é­”éŒ²ï¼ˆ400Ã—180ï¼‰ */
        .log-panel {
            width: 400px;  /* 400ã«å¤‰æ›´ */
            height: 180px; /* 180ã«å¤‰æ›´ */
            background: rgba(0, 0, 0, 0.9);
            border: 2px solid rgba(100, 100, 150, 0.4);
            border-radius: 10px;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .log-header {
            height: 28px;  /* å°ã•ã */
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            font-weight: 600;
            font-family: 'Cinzel', serif;
            color: #ffd700;
            background: rgba(0, 0, 0, 0.6);
            border-bottom: 1px solid rgba(100, 100, 150, 0.4);
            text-shadow: 0 0 8px rgba(255, 215, 0, 0.3);
            letter-spacing: 1px;
        }

        .log-content {
            flex: 1;
            padding: 6px 8px;
            overflow-y: auto;
            font-size: 15px;
            font-family: 'Cinzel', serif;
            line-height: 1.4;
            color: #f0f0f0;
        }

        .log-content::-webkit-scrollbar {
            width: 4px;
        }

        .log-content::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.3);
        }

        .log-content::-webkit-scrollbar-thumb {
            background: rgba(100, 100, 150, 0.6);
            border-radius: 2px;
        }

        .log-entry {
            margin-bottom: 5px;
            padding: 3px 0;
            border-bottom: 1px solid rgba(100, 100, 150, 0.15);
            font-size: 14px;
        }

        .log-round { 
            color: #e091e0; 
            font-weight: 600; 
            text-shadow: 0 0 5px rgba(224, 145, 224, 0.3);
        }
        .log-damage { 
            color: #ff6b6b; 
            font-weight: 500;
            text-shadow: 0 0 3px rgba(255, 107, 107, 0.3);
        }
        .log-gesture {
            color: #dda0dd;
            font-style: italic;
            text-shadow: 0 0 3px rgba(221, 160, 221, 0.4);
        }
        .log-message { 
            color: #ffd93d; 
            text-shadow: 0 0 3px rgba(255, 217, 61, 0.2);
        }
    </style>
</head>
<body>
    <!-- èƒŒæ™¯ç”»åƒãƒ¬ã‚¤ãƒ¤ãƒ¼ -->
    <div class="background-image"></div>
    
    <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ -->
    <div class="header">
        <div class="hp-section player">
            <span class="hp-label">éˆ´éŸ³ï¼ˆãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ï¼‰</span>
            <div class="hp-bar-container">
                <div class="hp-bar player" id="player-hp-bar" style="width: 100%"></div>
            </div>
            <span class="hp-text player">HP: <span id="player-hp">100</span>/<span id="player-max-hp">100</span></span>
        </div>

        <div class="round-display">
            <div class="round-text">ROUND <span id="round">1</span></div>
            <div class="score-display">
                <span>éˆ´éŸ³: <span class="score-win" id="player-wins">0</span>å‹</span>
                <span>å½©äºº: <span class="score-lose" id="enemy-wins">0</span>å‹</span>
            </div>
        </div>

        <div class="hp-section enemy">
            <span class="hp-text enemy">HP: <span id="enemy-hp">100</span>/100</span>
            <div class="hp-bar-container">
                <div class="hp-bar enemy" id="enemy-hp-bar" style="width: 100%"></div>
            </div>
            <span class="hp-label">å½©äººï¼ˆæ·«éœŠï¼‰</span>
        </div>
    </div>

    <!-- ãƒãƒˆãƒ«ã‚¨ãƒªã‚¢ -->
    <div class="battle-area">
        <div class="fighters-container">
            <div class="fighter">
                <div class="fighter-name player">éˆ´éŸ³</div>
                <div class="fighter-emoji">ğŸ’‹</div>
            </div>

            <div class="fighter">
                <div class="fighter-name enemy">å½©äºº</div>
                <div class="fighter-emoji">ğŸ‘»</div>
            </div>
        </div>

        <div class="exposure-display">
            <div class="exposure-dots">â—â—‹â—‹â—‹â—‹</div>
            <div class="exposure-label">å®Œå…¨è£…å‚™</div>
            <div class="exposure-desc">é€€æ·«å¸«ã¨ã—ã¦ã®æ­£è£…</div>
        </div>

        <div class="provoke-reveal" id="provoke-reveal"></div>
        <div class="enemy-message"></div>
    </div>

    <!-- æœè£…å¤‰åŒ–ã‚·ãƒ¼ãƒ³ -->
    <div class="clothing-change-scene" id="clothing-change-scene" style="display: none;">
        <div class="pov-container">
            <div class="suzune-character" id="suzune-character">
                <!-- éˆ´éŸ³ã®ç«‹ã¡çµµï¼ˆå·®åˆ†å¯¾å¿œï¼‰ -->
                <div class="character-base">ğŸ‘˜</div>
            </div>
            <div class="scene-instruction">
                <div class="instruction-text">ã‚¯ãƒªãƒƒã‚¯ã¾ãŸã¯SPACE/ENTERã‚­ãƒ¼ã§é€²ã‚€</div>
            </div>
        </div>
    </div>

    <!-- ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ï¼ˆç”»åƒã¨åŒã‚µã‚¤ã‚ºï¼‰ -->
    <div class="control-container">
        <div class="control-content">
            <!-- ãƒãƒ³ãƒ‰ã‚»ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ï¼ˆ400Ã—180ã€ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³å†…åŒ…ï¼‰ -->
            <div class="hand-selection">
                <div class="selection-status" id="selection-status">é¸æŠ: ãªã—</div>
                <div class="hands-and-actions">
                    <!-- æ‰‹é¸æŠãƒœã‚¿ãƒ³ã‚¨ãƒªã‚¢ -->
                    <div class="hand-buttons-area">
                        <button class="hand-btn" onclick="selectHand('stone')">
                            <span class="hand-icon">ğŸª¨</span>
                            <span class="hand-name">çŸ³æ‹³</span>
                            <span class="key-hint">KEY: 1</span>
                        </button>
                        <button class="hand-btn" onclick="selectHand('scissors')">
                            <span class="hand-icon">âœ‚ï¸</span>
                            <span class="hand-name">å‰ªåˆ€</span>
                            <span class="key-hint">KEY: 2</span>
                        </button>
                        <button class="hand-btn" onclick="selectHand('paper')">
                            <span class="hand-icon">ğŸŒŠ</span>
                            <span class="hand-name">å¸ƒæŒ</span>
                            <span class="key-hint">KEY: 3</span>
                        </button>
                    </div>

                    <!-- ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³ -->
                    <div class="action-buttons">
                        <button class="action-btn reveal-btn" id="reveal-btn" onclick="battle()" disabled>
                            SPACE: å…¬é–‹
                        </button>
                        <button class="action-btn provoke-btn" onclick="provoke()">
                            P: æŒ‘ç™º (<span id="provoke-count">2</span>)
                        </button>
                        <button class="action-btn restart-btn" id="restart-btn" onclick="restartRead()" disabled>
                            R: èª­ã¿ç›´ã— (<span id="restart-count">1</span>)
                        </button>
                    </div>
                </div>
            </div>

            <!-- é€€é­”éŒ² -->
            <div class="log-panel">
                <div class="log-header">é€€é­”éŒ²</div>
                <div class="log-content" id="log">
                    <div class="log-entry">
                        âš”ï¸ å½©äººã¨ã®æˆ¦é—˜é–‹å§‹
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ã‚²ãƒ¼ãƒ è¨­å®šï¼ˆCSVç­‰ã§å¤–éƒ¨ç®¡ç†å¯èƒ½ï¼‰
        const gameConfig = {
            player: {
                name: 'éˆ´éŸ³',
                emoji: 'ğŸ’‹',
                hp: 100
            },
            enemy: {
                name: 'å½©äºº',
                emoji: 'ğŸ‘»',
                hp: 100
            },
            background: {
                image: 'background.jpg',
                opacity: 0.3
            },
            messages: {
                win: 'å‹åˆ©ï¼{enemy}ã‚’é€€ã‘ã¾ã—ãŸï¼',
                lose: 'æ•—åŒ—...{enemy}ã«æ•—ã‚Œã¾ã—ãŸ...'
            }
        };

        let gameState = {
            round: 1,
            playerHP: gameConfig.player.hp,
            playerMaxHP: gameConfig.player.hp,
            enemyHP: gameConfig.enemy.hp,
            playerWins: 0,
            enemyWins: 0,
            draws: 0,
            selected: null,
            exposureLevel: 1,
            provokeCount: 2,
            provokeSuccess: false,
            revealedGesture: null,
            currentGesture: null,  // ç¾åœ¨ã®ä»•è‰ã‚’ä¿å­˜
            restartCount: 1  // èª­ã¿ç›´ã—å›æ•°
        };

        const handNames = {
            stone: 'çŸ³æ‹³',
            scissors: 'å‰ªåˆ€',
            paper: 'å¸ƒæŒ'
        };

        function selectHand(hand) {
            document.querySelectorAll('.hand-btn').forEach(btn => {
                btn.classList.remove('selected');
            });
            
            event.currentTarget.classList.add('selected');
            gameState.selected = hand;
            
            document.getElementById('selection-status').textContent = `é¸æŠ: ${handNames[hand]}`;
            document.getElementById('reveal-btn').disabled = false;
        }

        function battle() {
            if (!gameState.selected) return;
            
            const playerHand = gameState.selected;
            
            // ç¾åœ¨è¡¨ç¤ºã•ã‚Œã¦ã„ã‚‹ä»•è‰ã‚’ä½¿ç”¨ï¼ˆãƒšãƒ¼ã‚¸ãƒ­ãƒ¼ãƒ‰æ™‚ã«è¨­å®šæ¸ˆã¿ï¼‰
            const gestureResult = gameState.currentGesture;
            
            const enemyHand = getEnemyHandFromGesture(gestureResult);
            
            addLog(`[R${gameState.round}] éˆ´éŸ³: ${handNames[playerHand]} vs å½©äºº: ${handNames[enemyHand]}`);
            
            const result = getResult(playerHand, enemyHand);
            
            // ãƒ•ã‚§ã‚¤ã‚¯æ™‚ã®ã¿é€€é­”éŒ²ã«ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¿½åŠ 
            if (gestureResult.type === 'fake') {
                addLog(`ğŸ’­ å½©äººã®ä»•è‰ã¯ãƒ•ã‚§ã‚¤ã‚¯ã ã£ãŸ`, 'log-gesture');
            }
            
            if (result === 'win') {
                gameState.playerWins++;
                gameState.enemyHP -= 20;
                addLog(`[R${gameState.round}] éˆ´éŸ³ã®å‹åˆ©ï¼${handNames[playerHand]}ãŒ${handNames[enemyHand]}ã‚’ç ´ã£ãŸï¼`, 'log-round');
                addLog(`[R${gameState.round}] ãƒ€ãƒ¡ãƒ¼ã‚¸: 20`, 'log-damage');
            } else if (result === 'lose') {
                gameState.enemyWins++;
                gameState.playerHP -= 20;
                addLog(`[R${gameState.round}] å½©äººã®å‹åˆ©...`, 'log-round');
                addLog(`[R${gameState.round}] ãƒ€ãƒ¡ãƒ¼ã‚¸: 20`, 'log-damage');
                
                // æ•—åŒ—æ™‚éœ²å‡ºãƒ¬ãƒ™ãƒ«ä¸Šæ˜‡
                if (gameState.exposureLevel < 5) {
                    gameState.exposureLevel++;
                    const exposureData = exposureLevels[gameState.exposureLevel];
                    addLog(`ğŸ’” éœ²å‡ºãƒ¬ãƒ™ãƒ«ä¸Šæ˜‡: ${exposureData.name}`, 'log-round');
                    
                    // æœè£…å¤‰åŒ–ã‚·ãƒ¼ãƒ³ã‚’é–‹å§‹
                    setTimeout(() => {
                        startClothingChangeScene(gameState.exposureLevel);
                    }, 1000);
                }
            } else {
                gameState.draws++;
                addLog(`[R${gameState.round}] å¼•ãåˆ†ã‘`);
            }
            
            // å…¬é–‹å¾Œã«èª­ã¿ç›´ã—ãƒœã‚¿ãƒ³ã‚’æœ‰åŠ¹åŒ–ï¼ˆèª­ã¿ç›´ã—å›æ•°ãŒæ®‹ã£ã¦ã„ã‚‹å ´åˆã®ã¿ï¼‰
            if (gameState.restartCount > 0) {
                document.getElementById('restart-btn').disabled = false;
            }
            
            // çµæœã‚’è¡¨ç¤ºã—ã¦ã‹ã‚‰å°‘ã—å¾…ã£ã¦ã‹ã‚‰æ¬¡ã®ãƒ©ã‚¦ãƒ³ãƒ‰ã¸
            setTimeout(() => {
                // èª­ã¿ç›´ã—ãƒœã‚¿ãƒ³ã‚’ç„¡åŠ¹åŒ–
                document.getElementById('restart-btn').disabled = true;
                
                // æ¬¡ã®ãƒ©ã‚¦ãƒ³ãƒ‰ã¸é€²ã‚€
                proceedToNextRound();
            }, 1500);  // 1.5ç§’å¾Œã«æ¬¡ã®ãƒ©ã‚¦ãƒ³ãƒ‰ã¸
        }
        
        function proceedToNextRound() {
            gameState.round++;
            updateDisplay();
            resetSelection();
            
            // æ¬¡ã®æˆ¦é—˜ç”¨ã«æ–°ã—ã„ä»•è‰ã‚’ç”Ÿæˆ
            gameState.currentGesture = getAyatoGestureMessage();
            document.querySelector('.enemy-message').textContent = gameState.currentGesture.message;
            
            // æŒ‘ç™ºè¡¨ç¤ºã‚’ãƒªã‚»ãƒƒãƒˆ
            gameState.revealedGesture = false;
            gameState.provokeSuccess = false;
            document.getElementById('provoke-reveal').style.display = 'none';
            
            checkGameEnd();
        }

        function getEnemyHandFromGesture(gestureResult) {
            if (gestureResult.type === 'hint') {
                // 30%: ä»•è‰é€šã‚Šã®æ‰‹ã‚’å‡ºã™ï¼ˆãŸã ã—æŒ‘ç™ºæˆåŠŸå¾Œã¯15%ãƒ•ã‚§ã‚¤ã‚¯ã‚ã‚Šï¼‰
                if (gameState.provokeSuccess) {
                    const fakeRand = Math.random();
                    if (fakeRand < 0.15) {
                        // å½©äººå´15%ãƒ•ã‚§ã‚¤ã‚¯ - é•ã†æ‰‹ã‚’å‡ºã™
                        const otherHands = ['stone', 'scissors', 'paper'].filter(hand => hand !== gestureResult.hand);
                        return otherHands[Math.floor(Math.random() * otherHands.length)];
                    }
                }
                return gestureResult.hand;
            } else if (gestureResult.type === 'fake') {
                // 15%: ãƒ•ã‚§ã‚¤ã‚¯ - ä»•è‰ã¨ã¯é•ã†æ‰‹ã‚’ãƒ©ãƒ³ãƒ€ãƒ ã§å‡ºã™
                const otherHands = ['stone', 'scissors', 'paper'].filter(hand => hand !== gestureResult.hand);
                return otherHands[Math.floor(Math.random() * otherHands.length)];
            } else {
                // 55%: é€šå¸¸ã®ç¢ºç‡åˆ†å¸ƒ
                const rand = Math.random();
                if (rand < 0.33) return 'stone';
                if (rand < 0.67) return 'scissors';
                return 'paper';
            }
        }

        function getResult(playerHand, enemyHand) {
            if (playerHand === enemyHand) return 'draw';
            const wins = {
                stone: 'scissors',
                scissors: 'paper',
                paper: 'stone'
            };
            return wins[playerHand] === enemyHand ? 'win' : 'lose';
        }

        // éœ²å‡ºãƒ¬ãƒ™ãƒ«ãƒ‡ãƒ¼ã‚¿ï¼ˆCSVã‹ã‚‰å–å¾—ï¼‰
        const exposureLevels = {
            1: { name: "å®Œå…¨è£…å‚™", description: "é€€æ·«å¸«ã¨ã—ã¦ã®æ­£è£…", dots: "â—â—‹â—‹â—‹â—‹" },
            2: { name: "ä¸­è£…", description: "è£…å‚™ã®ä¸€éƒ¨å–ªå¤±", dots: "â—â—â—‹â—‹â—‹" },
            3: { name: "è»½è£…", description: "è£…å‚™ãŒå¤§å¹…æ¸›å°‘", dots: "â—â—â—â—‹â—‹" },
            4: { name: "è–„è£…", description: "æœ€å°é™ã®è£…å‚™", dots: "â—â—â—â—â—‹" },
            5: { name: "éœ²å‡º", description: "çµ¶ä½“çµ¶å‘½", dots: "â—â—â—â—â—" }
        };

        // æœè£…å¤‰åŒ–ã‚»ãƒªãƒ•
        const clothingDialogues = {
            suzune: {
                2: "ãã‚ƒã£...ï¼ä¸Šç€ãŒ...",
                3: "ã‚„ã ...ã‚¹ã‚«ãƒ¼ãƒˆã¾ã§...æ¥ãšã‹ã—ã„...",
                4: "ãã‚“ãª...ã‚‚ã†ã‚„ã‚ã¦...ï¼",
                5: "ã„ã‚„...ã“ã‚“ãªå§¿..."
            },
            ayato: {
                2: "ç¾ã—ã„...ãã®ä¹±ã‚ŒãŸå§¿ã‚‚èŠ¸è¡“ã ",
                3: "ã„ã„ã­...æ¥ã˜ã‚‰ã†è¡¨æƒ…ãŒæœ€é«˜ã ã‚ˆ",
                4: "ã‚‚ã†å°‘ã—ã§å®Œæˆã ...åƒ•ã®ä½œå“ãŒ",
                5: "ç´ æ™´ã‚‰ã—ã„...ã“ã‚Œãæ•—åŒ—ã®ç¾å­¦"
            }
        };

        // è¡¨ç¤ºæ¸ˆã¿ãƒ•ãƒ©ã‚°
        const shownDialogues = {
            2: false,
            3: false,
            4: false,
            5: false
        };

        // CSVç”»åƒç®¡ç†ã‚·ã‚¹ãƒ†ãƒ 
        let characterImages = {};
        
        // æœè£…å·®åˆ†ãƒ‡ãƒ¼ã‚¿ï¼ˆãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ç”¨ï¼‰
        const clothingLevels = {
            1: 'ğŸ‘˜',
            2: 'ğŸ½', 
            3: 'ğŸ‘™',
            4: 'ğŸ’‹',
            5: 'â¤ï¸'
        };

        // CSVç”»åƒãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã‚€é–¢æ•°
        async function loadCharacterImages() {
            try {
                const response = await fetch('data/character_images.csv');
                const csvText = await response.text();
                
                const lines = csvText.split('\n');
                const headers = lines[0].split(',');
                
                for (let i = 1; i < lines.length; i++) {
                    if (lines[i].trim() === '') continue;
                    
                    const values = lines[i].split(',');
                    const imageData = {};
                    
                    headers.forEach((header, index) => {
                        imageData[header.trim()] = values[index] ? values[index].trim() : '';
                    });
                    
                    const key = `${imageData.character_id}_lv${imageData.level}_${imageData.expression}`;
                    characterImages[key] = imageData;
                }
                
                console.log('ç”»åƒãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿å®Œäº†:', characterImages);
            } catch (error) {
                console.warn('ç”»åƒãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿å¤±æ•—ã€çµµæ–‡å­—ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ã‚’ä½¿ç”¨:', error);
            }
        }

        // ç”»åƒãƒ‘ã‚¹ã‚’å–å¾—ã™ã‚‹é–¢æ•°
        function getCharacterImage(characterId, level, expression = 'normal') {
            const key = `${characterId}_lv${level}_${expression}`;
            
            if (characterImages[key]) {
                return characterImages[key].image_path;
            }
            
            // ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯: çµµæ–‡å­—ã‚’è¿”ã™
            return null;
        }

        // ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼è¡¨ç¤ºã‚’æ›´æ–°ã™ã‚‹é–¢æ•°
        function updateCharacterDisplay(level, expression = 'normal') {
            const characterElement = document.querySelector('.character-base');
            const imagePath = getCharacterImage('suzune', level, expression);
            
            if (imagePath) {
                // ç”»åƒãŒåˆ©ç”¨å¯èƒ½ãªå ´åˆ
                characterElement.innerHTML = `<img src="${imagePath}" alt="éˆ´éŸ³ ãƒ¬ãƒ™ãƒ«${level}" style="width: 100%; height: 100%; object-fit: contain;">`;
            } else {
                // ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯: çµµæ–‡å­—è¡¨ç¤º
                characterElement.textContent = clothingLevels[level];
            }
        }

        // æœè£…å¤‰åŒ–ã‚·ãƒ¼ãƒ³åˆ¶å¾¡
        let currentClothingScene = {
            active: false,
            targetLevel: 1,
            currentStep: 0
        };

        // å½©äººã®ä»•è‰ã‚·ã‚¹ãƒ†ãƒ 
        const ayatoGestures = {
            stone: [
                "è¡¨æƒ…ãŒå°‘ã—ç¡¬ããªã£ãŸ...",
                "ä½•ã‹ã‚’å …ãå®ˆã‚‹ã‚ˆã†ãªé›°å›²æ°—ã‚’è¦‹ã›ã‚‹...",
                "è¦–ç·šã«æ„å¿—ã®å¼·ã•ãŒå®¿ã£ã¦ã„ã‚‹..."
            ],
            scissors: [
                "æŒ‡å…ˆã«ç¹Šç´°ãªå‹•ããŒè¦‹ãˆã‚‹...",
                "ä½•ã‹ã‚’åˆ‡ã‚Šåˆ†ã‘ã‚‹ã‚ˆã†ãªé›†ä¸­ã‚’è¦‹ã›ã‚‹...",
                "æ‰‹å…ƒã«é‹­ã„ç¾æ„è­˜ã‚’æ„Ÿã˜ã‚‹..."
            ],
            paper: [
                "æ‰‹ãŒè‡ªç„¶ã«ç·©ã‚“ã§ã„ã‚‹...",
                "åŒ…å®¹åŠ›ã®ã‚ã‚‹é›°å›²æ°—ã‚’é†¸ã—å‡ºã—ã¦ã„ã‚‹...",
                "å§¿å‹¢ãŒå„ªé›…ã«åºƒãŒã‚Šã‚’è¦‹ã›ã‚‹..."
            ]
        };

        function getAyatoGestureMessage() {
            const rand = Math.random();
            
            // 30%ã®ç¢ºç‡ã§æ­£ç¢ºãªãƒ’ãƒ³ãƒˆï¼ˆä»•è‰é€šã‚Šã®æ‰‹ã‚’å‡ºã™ï¼‰
            if (rand < 0.30) {
                const hands = ['stone', 'scissors', 'paper'];
                const selectedHand = hands[Math.floor(Math.random() * hands.length)];
                const gestures = ayatoGestures[selectedHand];
                const message = gestures[Math.floor(Math.random() * gestures.length)];
                return { type: 'hint', hand: selectedHand, message: message };
            }
            
            // 15%ã®ç¢ºç‡ã§ãƒ•ã‚§ã‚¤ã‚¯
            if (rand < 0.45) { // 0.30 + 0.15 = 0.45
                const hands = ['stone', 'scissors', 'paper'];
                const fakeHand = hands[Math.floor(Math.random() * hands.length)];
                const gestures = ayatoGestures[fakeHand];
                const message = gestures[Math.floor(Math.random() * gestures.length)];
                return { type: 'fake', hand: fakeHand, message: message };
            }
            
            // 55%ã®ç¢ºç‡ã§ä»•è‰ãªã—
            return { type: 'none', message: 'éš™ãŒãªãä»•è‰ã‚’å‡ºã•ãªã„' };
        }

        function provoke() {
            if (gameState.provokeCount <= 0) return;
            
            gameState.provokeCount--;
            document.getElementById('provoke-count').textContent = gameState.provokeCount;
            
            // 75%ã®ç¢ºç‡ã§æŒ‘ç™ºæˆåŠŸ
            const rand = Math.random();
            if (rand < 0.75) {
                // æŒ‘ç™ºæˆåŠŸ
                gameState.provokeSuccess = true;
                addLog('ğŸ¯ éˆ´éŸ³ã¯æŒ‘ç™ºã«æˆåŠŸã—ãŸ', 'log-message');
                
                // ã™ãã«ç¾åœ¨ã®ä»•è‰ã®æ„å‘³ã‚’è¡¨ç¤º
                gameState.revealedGesture = true;
                const provokeRevealDiv = document.getElementById('provoke-reveal');
                if (gameState.currentGesture && gameState.currentGesture.type !== 'none') {
                    const handJapanese = { stone: 'çŸ³æ‹³', scissors: 'å‰ªåˆ€', paper: 'å¸ƒæŒ' };
                    provokeRevealDiv.textContent = `${handJapanese[gameState.currentGesture.hand]}ã‚’å‡ºã™ã‚ˆã†ãªä»•è‰ã«è¦‹ãˆã‚‹ã€‚ã€‚ã€‚`;
                    provokeRevealDiv.style.display = 'block';
                }
            } else {
                // æŒ‘ç™ºå¤±æ•—
                gameState.provokeSuccess = false;
                addLog('âŒ æŒ‘ç™ºã¯å¤±æ•—ã—ãŸ...', 'log-damage');
                document.getElementById('provoke-reveal').style.display = 'none';
            }
            
            // æŒ‘ç™ºå›æ•°ãŒ0ã«ãªã£ãŸã‚‰ãƒœã‚¿ãƒ³ã‚’ç„¡åŠ¹åŒ–
            if (gameState.provokeCount <= 0) {
                document.querySelector('.provoke-btn').disabled = true;
            }
        }

        function updateDisplay() {
            document.getElementById('round').textContent = gameState.round;
            document.getElementById('player-hp').textContent = gameState.playerHP;
            document.getElementById('player-max-hp').textContent = gameState.playerMaxHP;
            document.getElementById('enemy-hp').textContent = gameState.enemyHP;
            document.getElementById('player-wins').textContent = gameState.playerWins;
            document.getElementById('enemy-wins').textContent = gameState.enemyWins;
            document.getElementById('provoke-count').textContent = gameState.provokeCount;
            document.getElementById('restart-count').textContent = gameState.restartCount;
            
            // æŒ‘ç™ºãƒœã‚¿ãƒ³ã®çŠ¶æ…‹æ›´æ–°
            const provokeBtn = document.querySelector('.provoke-btn');
            if (provokeBtn) {
                provokeBtn.disabled = gameState.provokeCount <= 0;
            }
            
            // HPãƒãƒ¼ã®æ›´æ–°ï¼ˆå…ƒã®æœ€å¤§HP100ãƒ™ãƒ¼ã‚¹ã§è¨ˆç®—ï¼‰
            const playerHpPercent = (gameState.playerHP / 100) * 100;
            const enemyHpPercent = (gameState.enemyHP / gameConfig.enemy.hp) * 100;
            
            document.getElementById('player-hp-bar').style.width = `${Math.max(0, playerHpPercent)}%`;
            document.getElementById('enemy-hp-bar').style.width = `${Math.max(0, enemyHpPercent)}%`;
            
            // éœ²å‡ºãƒ¬ãƒ™ãƒ«è¡¨ç¤ºæ›´æ–°
            updateExposureDisplay();
            
            // æˆ¦é—˜ç”»é¢ã®éˆ´éŸ³ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼è¡¨ç¤ºæ›´æ–°
            updateBattleCharacterDisplay();
        }
        
        function updateExposureDisplay() {
            const exposureData = exposureLevels[gameState.exposureLevel];
            console.log('éœ²å‡ºãƒ¬ãƒ™ãƒ«æ›´æ–°:', gameState.exposureLevel, exposureData); // ãƒ‡ãƒãƒƒã‚°
            document.querySelector('.exposure-dots').textContent = exposureData.dots;
            document.querySelector('.exposure-label').textContent = exposureData.name;
            document.querySelector('.exposure-desc').textContent = exposureData.description;
        }

        // æˆ¦é—˜ç”»é¢ã®éˆ´éŸ³ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼è¡¨ç¤ºã‚’æ›´æ–°
        function updateBattleCharacterDisplay() {
            const battleCharacterEmoji = document.querySelector('.fighter .fighter-emoji');
            
            // éœ²å‡ºãƒ¬ãƒ™ãƒ«ã«å¿œã˜ãŸçµµæ–‡å­—ã‚’è¨­å®š
            if (battleCharacterEmoji) {
                battleCharacterEmoji.textContent = clothingLevels[gameState.exposureLevel];
            }
        }

        function resetSelection() {
            document.querySelectorAll('.hand-btn').forEach(btn => {
                btn.classList.remove('selected');
            });
            gameState.selected = null;
            document.getElementById('selection-status').textContent = 'é¸æŠ: ãªã—';
            document.getElementById('reveal-btn').disabled = true;
        }

        function addLog(message, className = '') {
            const log = document.getElementById('log');
            const entry = document.createElement('div');
            entry.className = `log-entry ${className}`;
            entry.innerHTML = message;
            log.appendChild(entry);
            
            // 4ã¤ã¾ã§ã®è¡¨ç¤ºåˆ¶é™
            const entries = log.querySelectorAll('.log-entry');
            if (entries.length > 4) {
                log.removeChild(entries[0]);
            }
            
            log.scrollTop = log.scrollHeight;
        }

        // æœè£…å¤‰åŒ–ã‚·ãƒ¼ãƒ³é–¢æ•°
        function startClothingChangeScene(targetLevel) {
            currentClothingScene.active = true;
            currentClothingScene.targetLevel = targetLevel;
            currentClothingScene.currentStep = 0;
            
            const sceneElement = document.getElementById('clothing-change-scene');
            const suzuneCharacter = document.getElementById('suzune-character');
            const characterBase = document.querySelector('.character-base');
            
            sceneElement.style.display = 'block';
            
            // 2D Liveãƒ¢ãƒ¼ãƒ‰ã‚’æœ‰åŠ¹åŒ–
            suzuneCharacter.classList.add('live-mode');
            characterBase.classList.add('live-mode');
            
            setTimeout(() => {
                sceneElement.classList.add('active');
            }, 50);
            
            // åˆæœŸçŠ¶æ…‹è¨­å®šï¼ˆãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ï¼šçµµæ–‡å­—ï¼‰
            document.querySelector('.character-base').textContent = clothingLevels[gameState.exposureLevel - 1];
            
            // ã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆè¿½åŠ 
            document.addEventListener('click', handleClothingSceneClick);
            document.addEventListener('keydown', handleClothingSceneKey);
        }
        
        function handleClothingSceneClick() {
            if (!currentClothingScene.active) return;
            progressClothingScene();
        }
        
        function handleClothingSceneKey(e) {
            if (!currentClothingScene.active) return;
            if (e.key === ' ' || e.key === 'Enter') {
                e.preventDefault();
                progressClothingScene();
            }
        }
        
        function progressClothingScene() {
            const character = document.querySelector('.character-base');
            
            // è§¦ã‚Œã‚‰ã‚ŒãŸæ™‚ã®ãƒªã‚¢ã‚¯ã‚·ãƒ§ãƒ³åŠ¹æœã‚’è¿½åŠ 
            character.classList.add('touched');
            
            setTimeout(() => {
                // æœè£…å¤‰åŒ–æ™‚ã®è¡¨æƒ…å¤‰åŒ–
                const targetLevel = currentClothingScene.targetLevel;
                
                // éœ²å‡ºãƒ¬ãƒ™ãƒ«ã«å¿œã˜ãŸè¡¨æƒ…å¤‰åŒ–
                if (targetLevel >= 2 && targetLevel <= 3) {
                    character.classList.add('shy');
                } else if (targetLevel >= 4) {
                    character.classList.add('embarrassed');
                }
                
                // æœè£…å¤‰åŒ–
                character.textContent = clothingLevels[currentClothingScene.targetLevel];
                
                // ãƒªã‚¢ã‚¯ã‚·ãƒ§ãƒ³åŠ¹æœã‚’ã‚¯ãƒªã‚¢
                setTimeout(() => {
                    character.classList.remove('touched');
                }, 600);
                
                // ã‚·ãƒ¼ãƒ³çµ‚äº†
                setTimeout(() => {
                    endClothingChangeScene();
                }, 1000);
            }, 300);
        }
        
        function endClothingChangeScene() {
            const sceneElement = document.getElementById('clothing-change-scene');
            const suzuneCharacter = document.getElementById('suzune-character');
            const character = document.querySelector('.character-base');
            
            sceneElement.classList.remove('active');
            
            // 2D Liveãƒ¢ãƒ¼ãƒ‰ã‚’ç„¡åŠ¹åŒ–
            suzuneCharacter.classList.remove('live-mode');
            character.classList.remove('live-mode');
            
            // å…¨ã¦ã®ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¯ãƒ©ã‚¹ã‚’ã‚¯ãƒªã‚¢
            character.classList.remove('touched', 'shy', 'embarrassed');
            
            setTimeout(() => {
                sceneElement.style.display = 'none';
                currentClothingScene.active = false;
                
                // ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼å‰Šé™¤
                document.removeEventListener('click', handleClothingSceneClick);
                document.removeEventListener('keydown', handleClothingSceneKey);
                
                // æˆ¦é—˜ç”»é¢ã«æˆ»ã£ã¦ã‹ã‚‰ã‚»ãƒªãƒ•è¡¨ç¤º
                showClothingDialogues();
            }, 500);
        }
        
        function showClothingDialogues() {
            const level = currentClothingScene.targetLevel;
            
            if (!shownDialogues[level]) {
                shownDialogues[level] = true;
                
                // éˆ´éŸ³ã®ã‚»ãƒªãƒ•
                setTimeout(() => {
                    addLog(`éˆ´éŸ³: ${clothingDialogues.suzune[level]}`, 'log-message');
                    
                    // å½©äººã®åå¿œ
                    setTimeout(() => {
                        addLog(`å½©äºº: ${clothingDialogues.ayato[level]}`, 'log-gesture');
                        
                        // æœè£…å¤‰åŒ–å¾Œã«æˆ¦é—˜ç”»é¢ã®éˆ´éŸ³ã®è¡¨ç¤ºã‚’æ›´æ–°
                        updateBattleCharacterDisplay();
                    }, 1500);  // 1.5ç§’ã«èª¿æ•´
                }, 800);  // 0.8ç§’ã«èª¿æ•´
            }
        }

        function restartRead() {
            if (gameState.restartCount <= 0) return;
            
            // èª­ã¿ç›´ã—å›æ•°ã‚’æ¸›ã‚‰ã™
            gameState.restartCount--;
            document.getElementById('restart-count').textContent = gameState.restartCount;
            
            // èª­ã¿ç›´ã—å‡¦ç†ï¼šãƒ©ã‚¦ãƒ³ãƒ‰ã¯åŠ ç®—ã—ãªã„
            addLog('ğŸ’« éˆ´éŸ³ã¯ä¸‰æ‰‹ã‚’å‡ºã•ãšè¸ã¿ã¨ã©ã¾ã£ãŸ', 'log-message');
            
            // é¸æŠçŠ¶æ…‹ã‚’ãƒªã‚»ãƒƒãƒˆ
            resetSelection();
            
            // èª­ã¿ç›´ã—ãƒœã‚¿ãƒ³ã‚’ç„¡åŠ¹åŒ–ï¼ˆå…¬é–‹å¾Œã«ã¾ãŸæœ‰åŠ¹ã«ãªã‚‹ï¼‰
            document.getElementById('restart-btn').disabled = true;
            
            // èª­ã¿ç›´ã—å›æ•°ãŒ0ã«ãªã£ãŸã‚‰å®Œå…¨ã«ç„¡åŠ¹åŒ–
            if (gameState.restartCount <= 0) {
                document.getElementById('restart-btn').disabled = true;
            }
            
            // æŒ‘ç™ºè¡¨ç¤ºã‚’ã‚¯ãƒªã‚¢
            document.getElementById('provoke-reveal').style.display = 'none';
            gameState.revealedGesture = false;
            gameState.provokeSuccess = false;
        }

        function checkGameEnd() {
            // 5å‹æ¡ä»¶ãƒã‚§ãƒƒã‚¯
            if (gameState.playerWins >= 5) {
                setTimeout(() => {
                    alert('ğŸ‰ 5å‹é”æˆï¼éˆ´éŸ³ã®å¤§å‹åˆ©ï¼');
                    restartRound();
                }, 500);
            } else if (gameState.enemyWins >= 5) {
                setTimeout(() => {
                    alert('ğŸ’” 5æ•—...å½©äººã®å‹åˆ©');
                    restartFromDefeat();
                }, 500);
            } else if (gameState.playerHP <= 0) {
                setTimeout(() => {
                    alert('HP0ï¼å½©äººã«æ•—ã‚Œã¾ã—ãŸ...');
                    restartFromDefeat();
                }, 500);
            } else if (gameState.enemyHP <= 0) {
                setTimeout(() => {
                    alert('å½©äººã®HP0ï¼ã“ã®æˆ¦é—˜ã¯éˆ´éŸ³ã®å‹åˆ©ï¼');
                    restartRound();
                }, 500);
            }
        }
        
        function restartFromDefeat() {
            // HP0æ•—åŒ—ãƒ»5æ•—æ™‚ï¼šå®Œå…¨åˆæœŸåŒ–
            gameState.exposureLevel = 1;  // éœ²å‡ºãƒ¬ãƒ™ãƒ«ãƒªã‚»ãƒƒãƒˆ
            gameState.playerMaxHP = 100;  // æœ€å¤§HPãƒªã‚»ãƒƒãƒˆ  
            gameState.playerHP = 100;     // HPå®Œå…¨å›å¾©
            gameState.enemyHP = 100;
            gameState.round = 1;
            gameState.playerWins = 0;
            gameState.enemyWins = 0;
            gameState.draws = 0;
            gameState.provokeCount = 2;
            gameState.provokeSuccess = false;
            gameState.revealedGesture = null;
            gameState.restartCount = 1;
            
            // é€€é­”éŒ²ã‚¯ãƒªã‚¢
            document.getElementById('log').innerHTML = '';
            addLog('âš”ï¸ å½©äººã¨ã®æˆ¦é—˜é–‹å§‹');
            
            // æ–°ã—ã„ä»•è‰ã‚’ç”Ÿæˆ
            gameState.currentGesture = getAyatoGestureMessage();
            document.querySelector('.enemy-message').textContent = gameState.currentGesture.message;
            
            // æœè£…å¤‰åŒ–ã‚»ãƒªãƒ•ãƒ•ãƒ©ã‚°ã‚’ãƒªã‚»ãƒƒãƒˆ
            shownDialogues[2] = false;
            shownDialogues[3] = false;
            shownDialogues[4] = false;
            shownDialogues[5] = false;
            
            updateDisplay();
        }
        
        function restartRound() {
            // 5å‹ãƒ»æ•µHP0æ™‚ï¼šå®Œå…¨åˆæœŸåŒ–
            gameState.exposureLevel = 1;  // éœ²å‡ºãƒ¬ãƒ™ãƒ«ãƒªã‚»ãƒƒãƒˆ
            gameState.playerMaxHP = 100;  // æœ€å¤§HPãƒªã‚»ãƒƒãƒˆ
            gameState.playerHP = 100;     // HPå®Œå…¨å›å¾©
            gameState.enemyHP = 100;
            gameState.round = 1;
            gameState.playerWins = 0;
            gameState.enemyWins = 0;
            gameState.draws = 0;
            gameState.provokeCount = 2;
            gameState.provokeSuccess = false;
            gameState.revealedGesture = null;
            gameState.restartCount = 1;
            
            // é€€é­”éŒ²ã‚¯ãƒªã‚¢ã—ã¦æˆ¦é—˜é–‹å§‹
            document.getElementById('log').innerHTML = '';
            addLog('âš”ï¸ å½©äººã¨ã®æˆ¦é—˜é–‹å§‹');
            
            // æ–°ã—ã„ä»•è‰ã‚’ç”Ÿæˆ
            gameState.currentGesture = getAyatoGestureMessage();
            document.querySelector('.enemy-message').textContent = gameState.currentGesture.message;
            
            // æœè£…å¤‰åŒ–ã‚»ãƒªãƒ•ãƒ•ãƒ©ã‚°ã‚’ãƒªã‚»ãƒƒãƒˆ
            shownDialogues[2] = false;
            shownDialogues[3] = false;
            shownDialogues[4] = false;
            shownDialogues[5] = false;
            
            updateDisplay();
        }

        document.addEventListener('keydown', (e) => {
            const handBtns = document.querySelectorAll('.hand-btn');
            if (e.key === '1' && handBtns[0]) handBtns[0].click();
            if (e.key === '2' && handBtns[1]) handBtns[1].click();
            if (e.key === '3' && handBtns[2]) handBtns[2].click();
            if (e.key === ' ') {
                e.preventDefault();
                if (!document.getElementById('reveal-btn').disabled) {
                    battle();
                }
            }
            if (e.key === 'r' || e.key === 'R') {
                e.preventDefault();
                if (!document.getElementById('restart-btn').disabled) {
                    restartRead();
                }
            }
        });
        
        // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã®åˆæœŸåŒ–
        window.addEventListener('load', () => {
            updateDisplay();
            resetSelection();
            
            // åˆæœŸã‚¨ãƒãƒŸãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¨­å®šã—ã¦ä¿å­˜
            gameState.currentGesture = getAyatoGestureMessage();
            document.querySelector('.enemy-message').textContent = gameState.currentGesture.message;
        });
    </script>
</body>
</html>