# 変更履歴

## [0.9.2] - 2025-09-09

### 追加
- 🎪 **2D Live風戦闘システム実装**
  - 呼吸アニメーション（4秒周期の上下動・スケール変化）
  - 服の揺れ（3秒周期の微細な回転）
  - 触れられた時のリアクション（震える効果・色変化・filter効果）
  - 表情変化（恥ずかしがり・瞬き・赤面効果）
  - 条件付きアニメーション（服装変化シーン時のみ適用で既存機能への影響排除）

- 📁 **CSV画像管理システム構築**
  - `data/character_images.csv`による画像の一元管理システム
  - レベル別・表情別の画像パス設定機能（level, character_id, clothing_state, expression, animation_type）
  - フォールバック機能（画像なし時は絵文字表示の自動切り替え）
  - `loadCharacterImages()`関数による動的画像読み込み
  - `getCharacterImage()`関数による画像パス取得システム

- 🔗 **戦闘画面キャラクター表示連動**
  - 戦闘画面の鈴音表示を露出レベルに完全連動
  - `updateBattleCharacterDisplay()`関数による自動更新システム
  - 服装変化シーン後の戦闘画面キャラ表示自動更新
  - 露出レベル1-5（👘→🏽→👙→💋→❤️）に対応した段階的表示変化

### 改善
- 🎭 **服装変化シーンの最適化**
  - 絵文字からimg タグへの自動切り替え機能実装
  - 露出レベルに応じた表情変化とリアクションの連動
  - 手のエフェクトを削除してシンプル化（よりクリーンなUI）
  - キー操作説明の明確化（「クリックまたはSPACE/ENTERキーで進む」）

- ⚡ **アニメーション制御の最適化**
  - live-modeクラスによる条件付きアニメーション適用
  - 服装変化シーン開始時のみアニメーション有効化
  - シーン終了時の完全なアニメーションクリア機能
  - 既存の戦闘システムへの影響ゼロを実現

### 修正
- 🐛 **2D Liveアニメーションの影響問題解決**
  - 常時アニメーション適用による既存機能への干渉を完全解決
  - 仕草表示・三手操作の正常動作を保証
  - CSS競合問題の解決（transition vs animation）

- 🐛 **服装変化シーンUI問題修正**
  - 手の要素（player-hand）完全削除
  - hand.classList.add('grabbing')処理の削除
  - progressClothingScene()関数の簡略化

- 🐛 **戦闘画面とシーン連動問題解決**
  - showClothingDialogues()内でのupdateBattleCharacterDisplay()呼び出し追加
  - 表示更新タイミングの最適化
  - 露出レベル変更の即座反映

### 技術的改善
- CSS keyframes追加（breathing, clothSway, trembling, blinking, embarrassedReaction）
- JavaScript関数追加（updateBattleCharacterDisplay, updateCharacterDisplay）
- 条件付きクラス管理システム（live-mode, touched, shy, embarrassed）
- CSVデータ構造の標準化（character_images.csv）

### 仮完成確認
- ✅ **戦闘シーン仮OK確認**
  - 彩人戦システム（仕草・挑発・確率分布）: 完全動作
  - 2D Live風アニメーション: 服装変化シーン限定で動作
  - 戦闘画面キャラ連動: 露出レベルに応じた表示変化
  - UI/UX: シンプルで分かりやすい操作性

## [0.9.1] - 2025-09-09

### 追加
- ⚔️ **彩人戦システムの完全実装**
  - 基本性能パターン: stone 33%, scissors 34%, paper 33%（バランス型）
  - 芸術家の幽霊としての心理戦要素を完全実装

- 🎭 **仕草システムの完全実装**
  - 30%: 正確なヒント（9種類の微妙なメッセージからランダム選択、その通りの手を確定で出す）
  - 15%: フェイク（仕草メッセージを表示するが違う手を出す）
  - 55%: 「隙がなく仕草を出さない」（通常確率分布）
  - エネミーメッセージエリアでの自動表示システム

- 🎯 **挑発システムの完全実装**
  - 戦闘につき2回まで使用可能（0→2に変更）
  - 75%成功率で即座に仕草の意味が判明
  - 専用エリア（enemy-messageの上部）に「〇〇を出すような仕草に見える。。。」表示
  - 彩人側15%フェイク機能（挑発成功後も15%で違う手を出す）
  - 挑発カウント表示とボタン無効化システム

### 改善
- 📝 **メッセージシステムの最適化**
  - 9種類の仕草メッセージを露骨すぎない微妙な表現に変更
  - 「石拳」「剪刀」「布掌」の正式名称使用（紙拳→布掌に修正）
  - enemy-messageエリアの初期テキスト削除

- 🔄 **表示と実際の手の同期システム**
  - gameState.currentGestureによる仕草状態管理
  - ページロード時と戦闘時の仕草一致保証
  - 戦闘ごとの新しい仕草自動生成
  - リセット時の仕草再生成機能

- ⚡ **挑発タイミングの改善**
  - 挑発成功時の即座のフィードバック（次の戦闘まで待つ必要がなくなった）
  - 挑発判明メッセージの専用エリア表示

### 修正
- 🐛 **仕草と実際の手の不一致問題**
  - ページロード時と戦闘時で別々に生成していた問題を完全解決
  - 表示されている仕草通りに手が出るように修正

- 🐛 **フェイク実装の修正**
  - 彩人側がフェイクを出す仕組みを正しく実装
  - 15%の確率で仕草と違う手を出す動作を保証

- 🐛 **UI表示問題**
  - ループ後の「彩人との戦闘開始」メッセージ自動表示
  - 退魔録への適切なメッセージフロー

### 技術的改善
- JavaScript状態管理の強化（currentGesture、provokeSuccess、revealedGesture）
- CSS専用エリア追加（.provoke-reveal）
- 挑発システムと仕草システムの連携強化

## [0.9.0] - 2025-09-04

### 追加
- 👑 **最終ボス「冥王丸」戦システム完全実装**
  - 7体融合能力（全淫霊の特殊能力を併せ持つ最終ボス）
  - 特別ルール：5ターン制限、2連敗で服2枚脱衣、引き分けで1ダメージ
  - 最高難易度：50%フェイク率、30%仕草表示率、80%挑発反応率
  - data/meiomaru.csv作成（ボス専用戦闘データ）

- 📚 **冥王丸戦専用ストーリーシステム**
  - 朔夜戦終了後から冥王丸戦開始までの4段階完全ストーリー
  - 「朔夜戦終了後」「偽りの脱出」「真実の顕現」「最後の三手の儀」
  - 完全なタイプライター演出システム統合
  - 直接URL (`?battle=meiomaru-story`) からのアクセス対応

- 💬 **服装変化時台詞システム実装**
  - 全キャラクター（彩人・栗之助・太郎・双子・朔夜）の露出レベル変化時専用台詞
  - キャラクター固有の反応と個性表現
  - 戦闘中の没入感大幅向上

### 修正完了
- ✅ **朔夜戦システム完全修正**
  - HP依存戦略の正確な実装（HP70%+：石60%、HP40-70%：各33%、HP40%-：布60%）
  - data/sakuya.csv作成（朔夜専用戦闘データ）
  - 戦闘ログでの敵名表示修正（彩人→朔夜）
  - 勝利カウント更新の修正
  - **前回の技術的課題を完全解決**

- ✅ **話者判定システム完全修正**
  - 冥王丸、ナレーション、謎の声の正確な話者判定
  - 幻影キャラクター完全対応（朔夜の幻影、双子の幻影、太郎の幻影、栗之助の幻影、彩人の幻影）
  - 通常テキスト形式とHTMLタグ形式の両方対応
  - 黄色文字表示名の完全一致化（表示バグ修正）

### 改善
- 🎨 **UI配置最適化**
  - ストーリーシーンの次へボタン位置調整
  - 他のイベントと統一された配置・デザイン

### 技術的成果
- 🔧 **全システム動作確認完了**
  - 5体の淫霊（彩人・栗之助・太郎・双子・朔夜）+ 最終ボス（冥王丸）
  - 全バトルシステム、ストーリーシステム、UI表示システムの完全動作
  - キャッシュ問題、話者判定問題、URL routing問題すべて解決

## [0.8.3] - 2025-09-04

### 追加
- 🎭 **双子戦システム完全実装**
  - 陽真・陰真の二重人格システム（敗北時人格交代）
  - 人格別確率設定（陽真: 石70%・剪20%・布10% / 陰真: 石10%・剪20%・布70%）
  - ツインアタック（5ラウンドごと2回連続攻撃）
  - 50%仕草混乱率（違う人格のヒントが混入）
  - 人格別フェイク率・挑発反応率の差別化
  - 双子専用ストーリーシーン・特徴説明画面

### 改善
- 🔧 **キャッシュバスティング強化**
  - タイムスタンプ付きJSファイル読み込み
  - 強制リロード対応・ブラウザキャッシュ回避
  - バージョン管理システム導入

- 📊 **データ管理拡張**
  - data/twins.csv作成（双子戦闘特性データ）
  - 複数敵キャラクター対応システム完成

## [0.8.2] - 2025-09-03

### 追加
- 🎪 **太郎戦イベントシステム実装**
  - 栗之助戦後から太郎戦開始までの完全ストーリーシステム
  - 4シーン構成（栗之助の警告 → 地下階段 → 太郎登場 → 戦闘前会話）
  - 太郎特徴説明画面（適応型AI・友情モード等の詳細説明）
  - 開発用直接アクセスURL: `?battle=taro-story`

- 🧠 **太郎戦用話者判定システム**
  - 栗之助・鈴音・太郎・ナレーションの自動識別
  - 太郎戦専用の台詞パターン認識
  - 「太郎、ごめん」ノート記述のナレーション化

### 改善
- 🎯 **太郎特徴説明画面の実装準拠更新**
  - 基本性能: 60%カウンター + 40%ランダムの適応型AI
  - キャラ設定: 学生系淫霊（ゼミの地下室で死亡）、難易度★★★☆☆
  - 戦闘特徴: 仕草30%、フェイク10%、挑発対応80%、3連敗完全ランダム

- 🔧 **勝利カウント表示システム修正**
  - 淫霊切り替え時のDOM要素参照更新問題解決
  - 太郎戦勝利数の正確な表示を実現
  - 直接バトルURL機能の完全対応

### 修正
- 🐛 **UI表示問題の解決**
  - 太郎戦でのタイトル「第三淫霊：太郎（たろう）」正確表示
  - 話者名の正確な分別表示
  - ストーリーテキストのタイプライター効果修正

## [0.8.1] - 2025-09-02

### 追加
- 🎯 **戦闘前特徴説明システム実装**
  - 彩人特徴説明画面の新設（基本性能・キャラクター設定・戦闘特徴）
  - ストーリー終了後から戦闘開始前の新しい画面遷移
  - 戦略性向上のための相手情報表示システム

### 改善
- 📝 **ストーリーテキスト表示の大幅改良**
  - タイプライター効果の最適化（文字速度調整: 40ms→60ms）
  - 長い台詞の自動結合処理（複数行台詞を途切れなく表示）
  - 話者別表示システムの精度向上（ナレーション・鈴音・彩人・老人の明確な区別）
  - 句読点自動追加機能（疑問文「？」、感嘆文「！」、通常文「。」）
  
- 🎨 **UI/UXの細かな調整**
  - ストーリーテキスト枠の固定サイズ化（140px高さ）
  - 下段配置でコンパクト表示
  - 先頭記号（•・○◦●◯）の自動削除処理
  - HTMLタグ完全除去（ネストしたタグも対応）

### 修正
- 🐛 **テキスト処理の問題解決**
  - 彩人台詞「淫術拳とやらを見せてもらおう」の一文化
  - コードが文字として表示される問題の修正
  - 句読点重複問題の解決
  - 先頭記号が残る問題の完全解決

### 技術的改善
- JavaScript画面状態管理の拡張（isAyatoInfoScreen追加）
- CSS レスポンシブ対応の強化
- テキスト解析ロジックの高精度化
- HTMLエンティティデコード処理の追加

## [0.8.0] - 2025-09-02

### 追加
- 🎬 **オープニング・ストーリーシステム実装**
  - オープニング画面（タイトル・キャラクター表示）
  - チュートリアル画面（ゲームルール説明）
  - ストーリーシーン（4シーン構成の物語）
  - タイプライター効果によるテキスト演出
  - 画面遷移システム（オープニング→チュートリアル→ストーリー→バトル）

- 🎨 **UI/UXの大幅強化**
  - 鈴音キャラクターアニメーション（揺れ・瞬き効果）
  - 背景画像対応システム（全画面・全シーン対応）
  - プログレス表示機能（ストーリー進行状況）
  - キャラクター台詞・強調テキストのスタイリング

### 変更
- 📝 **ゲーム表記の統一**
  - タイトル：「退魔拳」→「淫術拳 〜封印を解かれし巫女〜」
  - 職業：「退魔師」→「淫術師」
  - 説明：「心理戦バトル」→「三手心理戦バトル」
  - タイトル表示を縦並び構成に変更

- 🎯 **チュートリアル内容の調整**
  - 淫霊の特性違いをネタバレしない表現に変更
  - 読み直しペナルティの正確な説明（次ラウンド負け時追加ダメージ）

### 技術的改善
- JavaScript画面状態管理の実装
- CSS背景画像システムの構築
- アニメーションキーフレームの追加
- レスポンシブ対応の強化

## [0.5.2] - 2024-08-31

### 修正
- 🐛 **栗之助戦のバグ修正**
  - ラウンド数と勝敗数の不一致問題を完全解決
  - 最初の3回石パターンの正確な実装
  - 石3回連続パターンのカウント問題修正
  - 10ラウンド終了後の進行問題修正

- 🎮 **栗之助の特殊パターン完成**
  - 1-3ラウンド：必ず石を出す
  - 4ラウンド以降：石80%、剪刀10%、布10%の確率
  - 石が出たら3回連続で石を出すパターン実装
  - HP40%以下でパニックモード（完全ランダム）

- 📊 **表示系の修正**
  - 表示ラウンド数を最大10に制限
  - 内部ロジックは正常に11ラウンドまで処理
  - 彩人戦・栗之助戦両方で正常動作確認

- 🎨 **POV演出システム**
  - 敗北時の服装段階変化演出の実装
  - クリック操作による露出レベル変更機能
  - 視覚的フィードバックの改善

### 技術的改善
- JavaScript構文エラーの修正（余分な括弧の削除）
- ラウンドカウントロジックの最適化
- 栗之助特有のロジックと通常ロジックの分離

## [0.5.1] - 2024-08-28

### 変更
- 🗑️ **UI要素削除**
  - 主導権表示の完全削除（ユーザーリクエスト）
  - POVテストボタンの削除

- 📊 **新機能追加**
  - 引き分けカウント表示の実装
  - 引き分け数をラウンド情報に追加表示

- 🎨 **レイアウト再構成**
  - 左パネル: 手選択ボタン＋アクションボタン
  - 右パネル: 退魔録（戦闘ログ）
  - 公開ボタンを上段に移動
  - パネル全体の中央揃え配置

- 🖼️ **背景システム強化**
  - 背景画像対応実装（mansion_background.jpg）
  - フォールバックグラデーション

### 修正完了
- ✅ **引き分けカウント表示問題解決**
  - デバッグログによる問題特定・修正完了
  - 引き分け数が正常に表示されるように修正

- ✅ **10ラウンド終了判定修正**
  - 10ラウンド超過問題を修正
  - 判定ロジックの簡素化・安定化

### 新機能追加
- 🎮 **第二幽霊システム（栗之助）**
  - 「次に進む」ボタンの実装（青色、もう一度ボタンの横）
  - data/kurinosuke.csvファイル作成
  - 完全な幽霊切り替え機能
  - 敵名称の動的変更（彩人→栗之助）
  - ゲーム状態完全リセット（ラウンド1、勝敗数0からスタート）
  - CSV読み込みシステム拡張（getKurinosukeData追加）

### UI改善
- 🎨 **退魔録パネル調整**
  - 高さ195px（左パネルと完全統一）
  - 横幅400px
  - スタイル統一（グレー枠線、白文字、白下線）
  - 左パネルとの完璧な高さ合わせ

## [0.5.0] - 2025-08-26

### 追加
- 🎨 **幻想的UI実装**
  - Google Fonts統合（Noto Serif JP + Cinzel）
  - 神秘的なテキストボックススタイリング
  - グラデーション背景とグローエフェクト

### 変更
- 📐 **レイアウト調整**
  - 仕草表示を鈴音側から彩人側に移動
  - 対峙スタイルの対戦レイアウト強化
  - 用語変更：「戦闘ログ」→「退魔録」

- 🔤 **フォントとタイポグラフィ**
  - 全体的にフォントサイズ拡大
  - 露出レベル表示の視認性向上
  - 退魔録ヘッダーの神秘的スタイリング

### 修正
- 🐛 **CORS問題解決**
  - HTTPサーバー使用推奨（http://localhost:8000）
  - CSV読み込みの安定化
  - 手の選択と公開ボタンの動作修正

## [0.4.0] - 2024-08-26

### 追加
- 🎨 **対峙型レイアウト実装**
  - 鈴音（左）VS 彩人（右）の配置
  - 中央にVS表示と主導権ゲージ
  - 格闘ゲームのような対戦感演出

- 🏆 **勝利パターン演出**
  - 完璧勝利（HP80以上）
  - 清廉勝利（露出度1維持）
  - 奇跡勝利（限界露出からの逆転）
  - 通常勝利

- 📊 **敗北/勝利イベントCSV**
  - defeat_events.csv
  - victory_events.csv

### 変更
- 📐 **レイアウト最適化**
  - 固定サイズからレスポンシブ対応（vw/vh単位）
  - 戦闘ログの自動サイズ調整
  - 画面サイズに応じた要素配置

- 🎮 **UI改善**
  - 仕草表示を露出度情報の下に移動
  - 読み直しツールチップ追加
  - 戦闘ログのスクロール廃止

### 修正
- 🐛 10ラウンド終了後に11表示になる問題を修正
- 🐛 戦闘ログが画面に収まりきらない問題を解決
- 🐛 勝敗判定ロジックの改善（3勝5敗などの処理）

## [0.3.0] - 2024-08-26

### 追加
- 👗 **露出システムの視覚化**
  - 5段階の服装変化表示
  - 絵文字による段階表現（👘→🎽→👙→💋→❤️）
  - 露出度に応じた特殊セリフ

- 📝 **CSV管理拡張**
  - exposure_levels.csv追加
  - 画像パス対応（将来の拡張用）

### 変更
- ⚖️ **ゲームバランス調整**
  - 勝利条件：3勝→5勝に変更
  - 最大ラウンド：5→10に変更
  - 露出度5での特殊エンディング追加

## [0.2.0] - 2024-08-26

### 追加
- 🎭 **心理戦システム完全実装**
  - 仕草システム（6種類、20%確率）
  - 挑発システム（3回限定、75%成功）
  - 読み直しシステム（1回限定、ペナルティ付き）

- 📊 **統計表示**
  - 仕草的中回数
  - 挑発成功回数
  - フェイク被害回数

### 変更
- 🎨 **UI配置変更**
  - 鈴音を主人公側（左）に配置
  - HP表示位置の最適化

## [0.1.0] - 2024-08-26

### 初期実装
- ⚔️ **基本バトルシステム**
  - 石拳、剪刀、布掌の三手選択
  - HP管理（100スタート、20ダメージ）
  - ラウンド制（5ラウンド）

- 📁 **CSV管理システム**
  - BOM付きUTF-8対応
  - config.csv（ゲーム設定）
  - ayato.csv（彩人データ）
  - tells.csv（仕草データ）

- 🖼️ **基本UI**
  - バトル画面レイアウト
  - HP表示
  - ラウンド表示
  - 戦闘ログ

## 技術仕様
- **フレームワーク**: 純粋なHTML/CSS/JavaScript
- **データ管理**: CSV（BOM付きUTF-8）
- **対応ブラウザ**: Chrome, Firefox, Safari, Edge（最新版）
- **画面サイズ**: レスポンシブ対応

## 今後の予定
- Phase 2: タイトル画面、BGM、他キャラクター追加
- Phase 3: 敗北イベント、刻印システム
- Phase 4: ストーリーモード、エンディング分岐